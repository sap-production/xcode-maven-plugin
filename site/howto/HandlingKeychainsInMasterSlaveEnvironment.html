<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jul 23, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Creation-yyyymmdd" content="201230620" />
    <meta name="Date-Revision-yyyymmdd" content="20130723" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Xcode Maven Plugin - Usage</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Xcode Maven Plugin</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-07-23</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.11.0</li>
                      
                
            
      
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                                
      <li>
    
                          <a href="../index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../plugin-info.html" title="Goals">
          <i class="none"></i>
        Goals</a>
            </li>
                  
      <li>
    
                          <a href="../usage.html" title="Usage">
          <i class="none"></i>
        Usage</a>
            </li>
                  
      <li>
    
                          <a href="../faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                  
      <li>
    
                          <a href="../release-notes.html" title="Release Notes">
          <i class="none"></i>
        Release Notes</a>
            </li>
                              <li class="nav-header">User Guide</li>
                                
      <li>
    
                          <a href="../userguide/Project Structure.html" title="Project Structure">
          <i class="none"></i>
        Project Structure</a>
            </li>
                  
      <li>
    
                          <a href="../userguide/Advanced Project Structure - Modules.html" title="Advanced Project Structure - Modules">
          <i class="none"></i>
        Advanced Project Structure - Modules</a>
            </li>
                  
      <li>
    
                          <a href="../userguide/Project Pom.html" title="Project Pom">
          <i class="none"></i>
        Project Pom</a>
            </li>
                  
      <li>
    
                          <a href="../userguide/Version information.html" title="Version information">
          <i class="none"></i>
        Version information</a>
            </li>
                                                                                
      <li>
    
                          <a href="../examples/AppBuildExample.html" title="Apps">
          <i class="icon-chevron-down"></i>
        Apps</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../userguide/Packaging the Xcode project with its resolved dependencies.html" title="Packaging the Xcode project with its resolved dependencies">
          <i class="none"></i>
        Packaging the Xcode project with its resolved dependencies</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Xcode Applications Artifacts Structure.html" title="Xcode Applications Artifacts Structure">
          <i class="none"></i>
        Xcode Applications Artifacts Structure</a>
            </li>
              </ul>
        </li>
                                                                                                                    
      <li>
    
                          <a href="../examples/LibBuildExample.html" title="Libraries">
          <i class="icon-chevron-down"></i>
        Libraries</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../userguide/Fat Binaries.html" title="Fat Binaries">
          <i class="none"></i>
        Fat Binaries</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Generation and Consumption Libraries with Bundles.html" title="Generation and Consumption Libraries with Bundles">
          <i class="none"></i>
        Generation and Consumption Libraries with Bundles</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Generation of API Docs with Doxygen.html" title="Generation of API Docs with Doxygen">
          <i class="none"></i>
        Generation of API Docs with Doxygen</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Xcode Libraries Artifacts Structure.html" title="Xcode Libraries Artifacts Structure">
          <i class="none"></i>
        Xcode Libraries Artifacts Structure</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="../examples/FmwkBuildExample.html" title="Static Xcode Frameworks">
          <i class="none"></i>
        Static Xcode Frameworks</a>
            </li>
                                                                                                  
      <li>
    
                          <a href="../userguide/Dependencies.html" title="Dependency Management">
          <i class="icon-chevron-down"></i>
        Dependency Management</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../userguide/Consumption of Libraries.html" target="_self" title="Consumption of Libraries">
          <i class="none"></i>
        Consumption of Libraries</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Consumption of Frameworks.html" title="Consumption of Frameworks">
          <i class="none"></i>
        Consumption of Frameworks</a>
            </li>
                      
      <li>
    
                          <a href="../userguide/Workspace.html" title="Develop Multiple Dependent Xcode Projects">
          <i class="none"></i>
        Develop Multiple Dependent Xcode Projects</a>
            </li>
              </ul>
        </li>
                              <li class="nav-header">How to</li>
                                
      <li>
    
                          <a href="../howto/IncludeMavenMetadataIntoALibrary.html" title="How to include maven metadata into a library">
          <i class="none"></i>
        How to include maven metadata into a library</a>
            </li>
                  
      <li>
    
                          <a href="../howto/UseGenericZipBundles.html" title="How to use generic ZIP bundles">
          <i class="none"></i>
        How to use generic ZIP bundles</a>
            </li>
                  
      <li>
    
                          <a href="../howto/HandlingAmbiguousDeveloperIdentities.html" title="How to handle ambiguous developer identities">
          <i class="none"></i>
        How to handle ambiguous developer identities</a>
            </li>
                  
      <li>
    
                          <a href="../howto/BuildCordovaHelloWorldExample.html" title="How to build the Cordova HelloWorld project">
          <i class="none"></i>
        How to build the Cordova HelloWorld project</a>
            </li>
                  
      <li>
    
                          <a href="../howto/EnableOTADeployment.html" title="How to enable Over-The-Air Deployment">
          <i class="none"></i>
        How to enable Over-The-Air Deployment</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>How to handle Keychains in a master/slave environment</a>
          </li>
                  
      <li>
    
                          <a href="../howto/BuildAggregatedFrameworks.html" title="How to build aggregated frameworks">
          <i class="none"></i>
        How to build aggregated frameworks</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                          
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                          
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://github.com/sap-production/xcode-maven-plugin/xcode-maven-plugin" data-size="tall" ></div>

                   <div class="clear"></div>
                   
        
        
        
    <iframe src="http://www.facebook.com/plugins/like.php?href=https://github.com/sap-production/xcode-maven-plugin/xcode-maven-plugin&send=false&layout=box_count&show-faces=false&action=like&colorscheme=light"
        scrolling="no" frameborder="0"
        style="border:none; width:48px; height:63px; margin-top: 10px;" ></iframe>
               <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- ~ --><!-- #%L --><!-- xcode-maven-plugin --><!-- %% --><!-- Copyright (C) 2012 SAP AG --><!-- %% --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!-- #L% --><!-- ~ --><div class="section"><h2>How to handle keychains in master/slave environments<a name="How_to_handle_keychains_in_masterslave_environments"></a></h2><div class="section"><h3>Purpose of this page<a name="Purpose_of_this_page"></a></h3><p>In order to be able to sign Xcode applications it is required to access the certificates for signing. These certificates are stored inside a keychain. The keychain must be open in order to retrieve the certificate for the built application. Typically the xcode-maven-plugin will be used on a continuous-integration infrastructure like e.g. Hudson or Jenkins. As long as the continuous-integration infrastructure is operated in a single node mode it is sufficient to put the certificate into the login keychain of the user that runs the continuous-integration server. The situation becomes difficult when operating continuous-integration servers in the master/slave mode. The preferred way to establish the communication between the master and the slave is ssh. Unfortunatally the keychains are not accessible by default when connecting to a machine using ssh. This page explains how applications can be signed on slaves using the xcode-maven-plugin in a master/slave setup. As already explaind above the challange is to get access to the keychain containing the certificate required for the codesiging.</p><p>The steps mentions below refer to Hudson/Jenkins as a build server.</p></div><div class="section"><h3>How applications can be signed using the xcode-maven-plugin in a master/slave environment<a name="How_applications_can_be_signed_using_the_xcode-maven-plugin_in_a_masterslave_environment"></a></h3><div class="section"><h4>The Problem<a name="The_Problem"></a></h4><p>When a slave is started we end up from the technical point of view in a call like </p><div class="source"><pre class="prettyprint">   [SSH] Opening SSH connection to &lt;SLAVE&gt;:22.
   [SSH] Authenticating as &lt;USER_NAME&gt;/******.
   [SSH] Authentication successful.
   ...
   [SSH] Starting slave process: cd '&lt;REMOTE_FS_ROOT&gt;' &amp;&amp; java -jar slave.jar</pre></div><p>When logging on via SSH the login keychain is not open - even if the same user is logged in with a graphical session on the target machine. In this case triggering an Xcode build for an application leads to:</p><div class="source"><pre class="prettyprint">    /usr/bin/codesign --force --sign &lt;IDENTITY&gt; --resource-rules=&lt;RESOURCE_RULES&gt; --entitlements &lt;ENTITLEMENTS&gt; &lt;PATH_TO_APP&gt;
    &lt;PATH_TO_APP&gt;: User interaction is not allowed.

   Command /usr/bin/codesign failed with exit code 1</pre></div><p>Codesign tries to ask for the keychain password in a modal dialog. This attempt fails since there is no graphical session. This is why we get the &quot;User interaction is not allowed.&quot; error message.</p></div><div class="section"><h4>The Solution<a name="The_Solution"></a></h4><p>The preferred way to open the keychain is during startup of the slave process. But so far there is no known way to open the keychain when the slave process is launched.</p><p>The second best way to open the keychain is to unlock it inside the Hudson/Jenkins job. The example code for opening a keychain looks like:</p><div class="source"><pre class="prettyprint">   #!/bin/bash

   ...

   keychain=&lt;PATH_TO_KEYCHAIN_FILE&gt; # e.g. $HOME/Library/Keychains/login.keychain
   security unlock-keychain -p &quot;&lt;PASSWORD&gt;&quot; ${keychain} &amp;&gt;/dev/null
   
   if [ $? -ne 0 ];then
     echo &quot;Cannot open keychain ${keychain}&quot;
     exit 1
   fi

   ...    </pre></div><ul><li>Setup a freestyle job.</li><li>Add a build step &quot;execute shell&quot;</li><li>Put the code snippet above into that shell together with the subsequent maven call (provide the keychain and the password. Path to the keychain file must be absolute).</li></ul></div></div><div class="section"><h3>Security Advices<a name="Security_Advices"></a></h3><p>In order to secure the password contained as plain text in the shell perform the following steps</p><ul><li>the umask should be set to 0077. This ensures that all files are created with access right 700. This ensures that config.xml files that contain the password in plain text cannot be accessed by other users.</li><li>#!/bin/bash <b>-x</b> must not be used. When the -x flag is used the commands are prompted into the log.</li><li>any output of the security call should be redirected to /dev/null</li><li>set the HISTSIZE to 0. (e.g. export HISTSIZE=0 inside ~/.bashrc). This prevents the password to be contained in the history.</li><li>Use Hudson/Jenkins security. Restrict the access rights in a way that the job configuration can only be read by authorized users.</li><li>Hudson/Jenkins should run under a dedicated user.</li></ul></div><div class="section"><h3>Tipps and Tricks<a name="Tipps_and_Tricks"></a></h3><ul><li>By default keychains are locked after a timeout interval. In long running builds it might happen that the keychain is closed again before the code sign step happens. The keychain will remain open infinitly after the command <tt>security set-keychain-settings &lt;PATH_TO_KEYCHAIN_FILE&gt; </tt>. It is sufficient to execute this command once in a shell since the timeout is a property of the keychain. It is not required to put this command into the maven build jobs in order to get it executed during each and every build.</li></ul></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2012-2013
                      SAP AG.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
